CREATE TABLE ark_realestate(re_id integer PRIMARY KEY, re_parentid integer, re_name_fr varchar(100), re_name_de varchar(100), re_desc varchar(100), node_path ltree);
CREATE UNIQUE INDEX idx_ark_realestate_node_path_btree_idx ON ark_realestate USING btree(node_path);
CREATE INDEX idx_ark_realestate_node_path_gist_idx ON ark_realestate USING gist(node_path);

CREATE OR REPLACE FUNCTION get_calculated_re_node_path(param_re_id integer)
 RETURNS ltree AS
$$
SELECT CASE WHEN p.re_parentid IS NULL THEN p.re_id::text::ltree
 ELSE get_calculated_re_node_path(p.re_parentid) || p.re_id::text END
  FROM ark_realestate As p
  WHERE p.re_id = $1;
$$
  LANGUAGE sql;

CREATE OR REPLACE FUNCTION trig_update_re_node_path() RETURNS trigger AS
$$
BEGIN
  IF TG_OP = 'UPDATE' THEN
        IF (COALESCE(OLD.re_parentid,0) != COALESCE(NEW.re_parentid,0)  OR  NEW.re_id != OLD.re_id) THEN
            UPDATE ark_realestate SET node_path = get_calculated_re_node_path(re_id) 
                WHERE OLD.node_path  @> ark_realestate.node_path;
        END IF;
  ELSIF TG_OP = 'INSERT' THEN
        UPDATE ark_realestate SET node_path = get_calculated_re_node_path(NEW.re_id) WHERE ark_realestate.re_id = NEW.re_id;
  END IF;
  
  RETURN NEW;
END
$$
LANGUAGE 'plpgsql' VOLATILE;

CREATE TRIGGER trig01_update_re_node_path AFTER INSERT OR UPDATE 
   ON ark_realestate FOR EACH ROW
   EXECUTE PROCEDURE trig_update_re_node_path();

INSERT INTO ark_realestate (re_id, re_parentid, re_name_fr, re_name_de, re_desc )
	VALUES
	(1, NULL, 'Habitat', 'Siedlung', ''),(2, 1, 'Indéterminé', 'Unbestimmt', ''),(3, 2, 'Non renseigné', 'nicht vorhanden', ''),(4, 2, 'Fosse', 'Grube', ''),(5, 2, 'Fossé', 'Graben', ''),(6, 1, 'Non renseigné', 'nicht vorhanden', ''),(7, 6, 'Non renseigné', 'nicht vorhanden', ''),(8, 6, 'Camp militaire', 'Lager', ''),(9, 6, 'Ferme', 'Bauernhof', ''),(10, 6, 'Villa', 'Villa', ''),(11, 6, 'Village hameau', 'Dorf Weiler', ''),(12, 6, 'Château', 'Schloss', ''),(13, 1, 'Fortifié', 'Befestigt', ''),(14, 13, 'Non renseigné', 'nicht vorhanden', ''),(15, 13, 'Camp militaire', 'Lager', ''),(16, 13, 'Ferme', 'Bauernhof', ''),(17, 13, 'Villa', 'Villa', ''),(18, 13, 'Village hameau', 'Dorf Weiler', ''),(19, 13, 'Château', 'Schloss', ''),(20, 1, 'Enclos', 'Schanze', ''),(21, 20, 'Non renseigné', 'nicht vorhanden', ''),(22, 20, 'Camp militaire', 'Lager', ''),(23, 20, 'Ferme', 'Bauernhof', ''),(24, 20, 'Villa', 'Villa', ''),(25, 20, 'Village hameau', 'Dorf Weiler', ''),(26, 20, 'Château', 'Schloss', ''),(27, 1, 'Ouvert', 'Unbefestigt', ''),(28, 27, 'Non renseigné', 'nicht vorhanden', ''),(29, 27, 'Camp militaire', 'Lager', ''),(30, 27, 'Ferme', 'Bauernhof', ''),(31, 27, 'Villa', 'Villa', ''),(32, 27, 'Village hameau', 'Dorf Weiler', ''),(33, 27, 'Château', 'Schloss', ''),(34, 1, 'Groupé', 'Dicht', ''),(35, 34, 'Non renseigné', 'nicht vorhanden', ''),(36, 34, 'Camp militaire', 'Lager', ''),(37, 34, 'Ferme', 'Bauernhof', ''),(38, 34, 'Villa', 'Villa', ''),(39, 34, 'Village hameau', 'Dorf Weiler', ''),(40, 34, 'Château', 'Schloss', ''),(41, 1, 'Isolé', 'Alleinstehend', ''),(42, 41, 'Non renseigné', 'nicht vorhanden', ''),(43, 41, 'Camp militaire', 'Lager', ''),(44, 41, 'Ferme', 'Bauernhof', ''),(45, 41, 'Villa', 'Villa', ''),(46, 41, 'Village hameau', 'Dorf Weiler', ''),(47, 41, 'Château', 'Schloss', ''),(48, NULL, 'Funéraire', 'Gräber', ''),(49, 48, 'Indéterminé', 'Unbestimmt', ''),(50, 49, 'Non renseigné', 'nicht vorhanden', ''),(51, 50, 'Architecture de bois', 'Holzarchitektur', ''),(52, 50, 'Architecture de pierre', 'Steinarchitektur', ''),(53, 50, 'Enclos sépulcral', 'Grabbezirk', ''),(54, 49, 'Inhumation', 'Leichengrab', ''),(55, 54, 'Architecture de bois', 'Holzarchitektur', ''),(56, 54, 'Architecture de pierre', 'Steinarchitektur', ''),(57, 54, 'Enclos sépulcral', 'Grabbezirk', ''),(58, 49, 'Incinération', 'Brandgrab', ''),(59, 58, 'Architecture de bois', 'Holzarchitektur', ''),(60, 58, 'Architecture de pierre', 'Steinarchitektur', ''),(61, 58, 'Enclos sépulcral', 'Grabbezirk', ''),(62, 49, 'Les deux', 'Beides', ''),(63, 62, 'Architecture de bois', 'Holzarchitektur', ''),(64, 62, 'Architecture de pierre', 'Steinarchitektur', ''),(65, 62, 'Enclos sépulcral', 'Grabbezirk', ''),(66, 48, 'Enclos Funéraire', 'Grabschanze', ''),(67, 66, 'Non renseigné', 'nicht vorhanden', ''),(68, 67, 'Tombe de grand module', 'Grossgrab', ''),(69, 67, 'Architecture de bois', 'Holzarchitektur', ''),(70, 67, 'Architecture de pierre', 'Steinarchitektur', ''),(71, 67, 'Enclos sépulcral', 'Grabbezirk', ''),(72, 66, 'Inhumation', 'Leichengrab', ''),(73, 72, 'Tombe de grand module', 'Grossgrab', ''),(74, 72, 'Architecture de bois', 'Holzarchitektur', ''),(75, 72, 'Architecture de pierre', 'Steinarchitektur', ''),(76, 72, 'Enclos sépulcral', 'Grabbezirk', ''),(77, 66, 'Incinération', 'Brandgrab', ''),(78, 77, 'Tombe de grand module', 'Grossgrab', ''),(79, 77, 'Architecture de bois', 'Holzarchitektur', ''),(80, 77, 'Architecture de pierre', 'Steinarchitektur', ''),(81, 77, 'Enclos sépulcral', 'Grabbezirk', ''),(82, 66, 'Les deux', 'Beides', ''),(83, 82, 'Tombe de grand module', 'Grossgrab', ''),(84, 82, 'Architecture de bois', 'Holzarchitektur', ''),(85, 82, 'Architecture de pierre', 'Steinarchitektur', ''),(86, 82, 'Enclos sépulcral', 'Grabbezirk', ''),(87, 48, 'Tombe plate isolée', 'Einzelner Grab', ''),(88, 87, 'Non renseigné', 'nicht vorhanden', ''),(89, 88, 'Architecture de bois', 'Holzarchitektur', ''),(90, 88, 'Architecture de pierre', 'Steinarchitektur', ''),(91, 88, 'Enclos sépulcral', 'Grabbezirk', ''),(92, 87, 'Inhumation', 'Leichengrab', ''),(93, 92, 'Architecture de bois', 'Holzarchitektur', ''),(94, 92, 'Architecture de pierre', 'Steinarchitektur', ''),(95, 92, 'Enclos sépulcral', 'Grabbezirk', ''),(96, 87, 'Incinération', 'Brandgrab', ''),(97, 96, 'Architecture de bois', 'Holzarchitektur', ''),(98, 96, 'Architecture de pierre', 'Steinarchitektur', ''),(99, 96, 'Enclos sépulcral', 'Grabbezirk', ''),(100, 87, 'Les deux', 'Beides', ''),(101, 100, 'Architecture de bois', 'Holzarchitektur', ''),(102, 100, 'Architecture de pierre', 'Steinarchitektur', ''),(103, 100, 'Enclos sépulcral', 'Grabbezirk', ''),(104, 48, 'Tumulus isolé', 'Einzelner Tumulus', ''),(105, 104, 'Non renseigné', 'nicht vorhanden', ''),(106, 105, 'Tombe de grand module', 'Grossgrab', ''),(107, 105, 'Architecture de bois', 'Holzarchitektur', ''),(108, 105, 'Architecture de pierre', 'Steinarchitektur', ''),(109, 105, 'Enclos sépulcral', 'Grabbezirk', ''),(110, 104, 'Inhumation', 'Leichengrab', ''),(111, 110, 'Tombe de grand module', 'Grossgrab', ''),(112, 110, 'Architecture de bois', 'Holzarchitektur', ''),(113, 110, 'Architecture de pierre', 'Steinarchitektur', ''),(114, 110, 'Enclos sépulcral', 'Grabbezirk', ''),(115, 104, 'Incinération', 'Brandgrab', ''),(116, 115, 'Tombe de grand module', 'Grossgrab', ''),(117, 115, 'Architecture de bois', 'Holzarchitektur', ''),(118, 115, 'Architecture de pierre', 'Steinarchitektur', ''),(119, 115, 'Enclos sépulcral', 'Grabbezirk', ''),(120, 104, 'Les deux', 'Beides', ''),(121, 120, 'Tombe de grand module', 'Grossgrab', ''),(122, 120, 'Architecture de bois', 'Holzarchitektur', ''),(123, 120, 'Architecture de pierre', 'Steinarchitektur', ''),(124, 120, 'Enclos sépulcral', 'Grabbezirk', ''),(125, 48, 'Nécropole tumulaire', 'Tumuli Nekropole', ''),(126, 125, 'Non renseigné', 'nicht vorhanden', ''),(127, 126, 'Tombe de grand module', 'Grossgrab', ''),(128, 126, 'Architecture de bois', 'Holzarchitektur', ''),(129, 126, 'Architecture de pierre', 'Steinarchitektur', ''),(130, 126, 'Enclos sépulcral', 'Grabbezirk', ''),(131, 125, 'Inhumation', 'Leichengrab', ''),(132, 131, 'Tombe de grand module', 'Grossgrab', ''),(133, 131, 'Architecture de bois', 'Holzarchitektur', ''),(134, 131, 'Architecture de pierre', 'Steinarchitektur', ''),(135, 131, 'Enclos sépulcral', 'Grabbezirk', ''),(136, 125, 'Incinération', 'Brandgrab', ''),(137, 136, 'Tombe de grand module', 'Grossgrab', ''),(138, 136, 'Architecture de bois', 'Holzarchitektur', ''),(139, 136, 'Architecture de pierre', 'Steinarchitektur', ''),(140, 136, 'Enclos sépulcral', 'Grabbezirk', ''),(141, 125, 'Les deux', 'Beides', ''),(142, 141, 'Tombe de grand module', 'Grossgrab', ''),(143, 141, 'Architecture de bois', 'Holzarchitektur', ''),(144, 141, 'Architecture de pierre', 'Steinarchitektur', ''),(145, 141, 'Enclos sépulcral', 'Grabbezirk', ''),(146, 48, 'Nécropole tombes plates', 'Gräberfeld', ''),(147, 146, 'Non renseigné', 'nicht vorhanden', ''),(148, 147, 'Architecture de bois', 'Holzarchitektur', ''),(149, 147, 'Architecture de pierre', 'Steinarchitektur', ''),(150, 147, 'Enclos sépulcral', 'Grabbezirk', ''),(151, 146, 'Inhumation', 'Leichengrab', ''),(152, 151, 'Architecture de bois', 'Holzarchitektur', ''),(153, 151, 'Architecture de pierre', 'Steinarchitektur', ''),(154, 151, 'Enclos sépulcral', 'Grabbezirk', ''),(155, 146, 'Incinération', 'Brandgrab', ''),(156, 155, 'Architecture de bois', 'Holzarchitektur', ''),(157, 155, 'Architecture de pierre', 'Steinarchitektur', ''),(158, 155, 'Enclos sépulcral', 'Grabbezirk', ''),(159, 146, 'Les deux', 'Beides', ''),(160, 159, 'Architecture de bois', 'Holzarchitektur', ''),(161, 159, 'Architecture de pierre', 'Steinarchitektur', ''),(162, 159, 'Enclos sépulcral', 'Grabbezirk', ''),(163, NULL, 'Isolé', 'Einzelfund', ''),(164, 163, 'Dépot', 'Hortfund', ''),(165, 164, 'Inscription', 'Inschrift', ''),(166, 164, 'Non-inscrit', 'Ohne inschrift', ''),(167, 164, 'Figuré', 'Figürlich', ''),(168, 163, 'Bloc architectural', 'Baustein gewaesserfund', ''),(169, 168, 'Inscription', 'Inschrift', ''),(170, 168, 'Non-inscrit', 'Ohne inschrift', ''),(171, 168, 'Figuré', 'Figürlich', ''),(172, 163, 'Statuaire', 'Statue', ''),(173, 172, 'Inscription', 'Inschrift', ''),(174, 172, 'Non-inscrit', 'Ohne inschrift', ''),(175, 172, 'Figuré', 'Figürlich', ''),(176, 163, 'Stèle', 'Stele', ''),(177, 176, 'Inscription', 'Inschrift', ''),(178, 176, 'Non-inscrit', 'Ohne inschrift', ''),(179, 176, 'Figuré', 'Figürlich', ''),(180, NULL, 'Rituel', 'Kult', ''),(181, 180, 'Indéterminé', 'Unbestimmt', ''),(182, 181, 'Association de mobiliers', 'Fundzusammenhang', ''),(183, 181, 'Vases miniatures', 'Miniaturvasen', ''),(184, 181, 'Rouelles', 'Radamulett', ''),(185, 181, 'Jetons', 'Jeton', ''),(186, 181, 'Ossements humains', 'Menschknochen', ''),(187, 181, 'Ossements animaux', 'Tierknochen', ''),(188, 181, 'Arme mutilée', 'Waffen verbogen', ''),(189, 181, 'Statuette', 'Statuette', ''),(190, 180, 'Temple', 'Tempel', ''),(191, 190, 'Association de mobiliers', 'Fundzusammenhang', ''),(192, 190, 'Vases miniatures', 'Miniaturvasen', ''),(193, 190, 'Rouelles', 'Radamulett', ''),(194, 190, 'Jetons', 'Jeton', ''),(195, 190, 'Ossements humains', 'Menschknochen', ''),(196, 190, 'Ossements animaux', 'Tierknochen', ''),(197, 190, 'Arme mutilée', 'Waffen verbogen', ''),(198, 190, 'Statuette', 'Statuette', ''),(199, 180, 'Source', 'Quelle', ''),(200, 199, 'Association de mobiliers', 'Fundzusammenhang', ''),(201, 199, 'Vases miniatures', 'Miniaturvasen', ''),(202, 199, 'Rouelles', 'Radamulett', ''),(203, 199, 'Jetons', 'Jeton', ''),(204, 199, 'Ossements humains', 'Menschknochen', ''),(205, 199, 'Ossements animaux', 'Tierknochen', ''),(206, 199, 'Arme mutilée', 'Waffen verbogen', ''),(207, 199, 'Statuette', 'Statuette', ''),(208, 180, 'Fanum', 'Fanum', ''),(209, 208, 'Association de mobiliers', 'Fundzusammenhang', ''),(210, 208, 'Vases miniatures', 'Miniaturvasen', ''),(211, 208, 'Rouelles', 'Radamulett', ''),(212, 208, 'Jetons', 'Jeton', ''),(213, 208, 'Ossements humains', 'Menschknochen', ''),(214, 208, 'Ossements animaux', 'Tierknochen', ''),(215, 208, 'Arme mutilée', 'Waffen verbogen', ''),(216, 208, 'Statuette', 'Statuette', ''),(217, 180, 'Puits', 'Brunnen', ''),(218, 217, 'Association de mobiliers', 'Fundzusammenhang', ''),(219, 217, 'Vases miniatures', 'Miniaturvasen', ''),(220, 217, 'Rouelles', 'Radamulett', ''),(221, 217, 'Jetons', 'Jeton', ''),(222, 217, 'Ossements humains', 'Menschknochen', ''),(223, 217, 'Ossements animaux', 'Tierknochen', ''),(224, 217, 'Arme mutilée', 'Waffen verbogen', ''),(225, 217, 'Statuette', 'Statuette', ''),(226, 180, 'Grotte', 'Höhle', ''),(227, 226, 'Association de mobiliers', 'Fundzusammenhang', ''),(228, 226, 'Vases miniatures', 'Miniaturvasen', ''),(229, 226, 'Rouelles', 'Radamulett', ''),(230, 226, 'Jetons', 'Jeton', ''),(231, 226, 'Ossements humains', 'Menschknochen', ''),(232, 226, 'Ossements animaux', 'Tierknochen', ''),(233, 226, 'Arme mutilée', 'Waffen verbogen', ''),(234, 226, 'Statuette', 'Statuette', ''),(235, 180, 'Dans l’habitat', 'Im sieldungskontext', ''),(236, 235, 'Association de mobiliers', 'Fundzusammenhang', ''),(237, 235, 'Vases miniatures', 'Miniaturvasen', ''),(238, 235, 'Rouelles', 'Radamulett', ''),(239, 235, 'Jetons', 'Jeton', ''),(240, 235, 'Ossements humains', 'Menschknochen', ''),(241, 235, 'Ossements animaux', 'Tierknochen', ''),(242, 235, 'Arme mutilée', 'Waffen verbogen', ''),(243, 235, 'Statuette', 'Statuette', ''),(244, 180, 'Isolé', 'Alleinstehend', ''),(245, 244, 'Association de mobiliers', 'Fundzusammenhang', ''),(246, 244, 'Vases miniatures', 'Miniaturvasen', ''),(247, 244, 'Rouelles', 'Radamulett', ''),(248, 244, 'Jetons', 'Jeton', ''),(249, 244, 'Ossements humains', 'Menschknochen', ''),(250, 244, 'Ossements animaux', 'Tierknochen', ''),(251, 244, 'Arme mutilée', 'Waffen verbogen', ''),(252, 244, 'Statuette', 'Statuette', ''),(253, 180, 'Eglise', 'Kirche', ''),(254, 253, 'Association de mobiliers', 'Fundzusammenhang', ''),(255, 253, 'Vases miniatures', 'Miniaturvasen', ''),(256, 253, 'Rouelles', 'Radamulett', ''),(257, 253, 'Jetons', 'Jeton', ''),(258, 253, 'Ossements humains', 'Menschknochen', ''),(259, 253, 'Ossements animaux', 'Tierknochen', ''),(260, 253, 'Arme mutilée', 'Waffen verbogen', ''),(261, 253, 'Statuette', 'Statuette', ''),(262, 180, 'Abbaye', 'Kloster', ''),(263, 262, 'Association de mobiliers', 'Fundzusammenhang', ''),(264, 262, 'Vases miniatures', 'Miniaturvasen', ''),(265, 262, 'Rouelles', 'Radamulett', ''),(266, 262, 'Jetons', 'Jeton', ''),(267, 262, 'Ossements humains', 'Menschknochen', ''),(268, 262, 'Ossements animaux', 'Tierknochen', ''),(269, 262, 'Arme mutilée', 'Waffen verbogen', ''),(270, 262, 'Statuette', 'Statuette', ''),(271, NULL, 'Voie', 'Wege', ''),(272, 271, 'Gué', 'Furth', ''),(273, 272, 'Quai', 'Quai', ''),(274, 272, 'Aménagement de berge', 'Uferbefestigung', ''),(275, 272, 'Pente aménagée', 'Steige', ''),(276, 271, 'Pont', 'Brücke', ''),(277, 276, 'Quai', 'Kai', ''),(278, 276, 'Aménagement de berge', 'Uferbefestigung', ''),(279, 276, 'Pente aménagée', 'Steige', ''),(280, 271, 'Borne', 'Meilenstein', ''),(281, 280, 'Quai', 'Kai', ''),(282, 280, 'Aménagement de berge', 'Uferbefestigung', ''),(283, 280, 'Pente aménagée', 'Steige', ''),(284, NULL, 'Structure agraire', 'Agrar', ''),(285, 284, 'Enclos', 'Schanze', ''),(286, 284, 'Champ bombé', 'Wölbacker', ''),(287, 284, 'Terrasse agricole', 'Ackerterrasse', ''),(288, 284, 'Murger', 'Steinrudel ', ''),(289, 284, 'Crêtes de labours', 'Crêtes de labours', '');